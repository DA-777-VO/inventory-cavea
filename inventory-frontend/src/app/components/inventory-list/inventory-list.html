<div class="container-lg">

  <div class="page-header mb-4">
    <div class="row align-items-center">
      <div class="col-md-6">
        <h2 class="page-title mb-3 mb-md-0">
          <span class="title-icon">­ЪЊд</span>
          рЃўрЃюрЃЋрЃћрЃюрЃбрЃљрЃарЃўрЃА рЃАрЃўрЃљ
        </h2>
      </div>
      <div class="col-md-6 text-md-end">
        <a routerLink="/add" class="btn btn-primary me-2">
          <span class="btn-icon">РъЋ</span>
          рЃюрЃўрЃЋрЃЌрЃўрЃА рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃљ
        </a>
        <a routerLink="/statistics" class="btn btn-info">
          <span class="btn-icon">­ЪЊі</span>
          рЃАрЃбрЃљрЃбрЃўрЃАрЃбрЃўрЃЎрЃљ
        </a>
      </div>
    </div>
  </div>


  <div class="card mb-4">
    <div class="card-body">
      <div class="row">
        <div class="col-md-4">
          <label for="locationFilter" class="form-label fw-semibold">
            <span class="filter-icon">­Ъј»</span>
            рЃцрЃўрЃџрЃбрЃарЃў рЃљрЃЊрЃњрЃўрЃџрЃЏрЃЊрЃћрЃЉрЃљрЃарЃћрЃЮрЃЉрЃўрЃА рЃЏрЃўрЃ«рЃћрЃЊрЃЋрЃўрЃЌ
          </label>
          <select
            id="locationFilter"
            class="form-select"
            [(ngModel)]="selectedLocationId"
            (change)="onLocationChange()">
            <option value="all">рЃДрЃЋрЃћрЃџрЃљ</option>
            @for (location of locations(); track location.id) {
              <option [value]="location.id">{{ location.name }}</option>
            }
          </select>
        </div>
      </div>
    </div>
  </div>


  <div class="card shadow-sm">
    <div class="card-body p-0">

      @if (loading()) {
        <div class="loading-container">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">рЃўрЃбрЃЋрЃўрЃарЃЌрЃћрЃЉрЃљ...</span>
          </div>
          <p class="loading-text mt-3">рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃўрЃА рЃЕрЃљрЃбрЃЋрЃўрЃарЃЌрЃЋрЃљ...</p>
        </div>
      } @else {

        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-dark">
            <tr>
              <th class="sortable" (click)="onSort('name')" [class.sorted]="sortBy() === 'name'">
                  <span class="d-flex align-items-center justify-content-between">
                    рЃАрЃљрЃ«рЃћрЃџрЃў
                    <span class="sort-indicator">{{ getSortIcon('name') }}</span>
                  </span>
              </th>
              <th class="sortable" (click)="onSort('location')" [class.sorted]="sortBy() === 'location'">
                  <span class="d-flex align-items-center justify-content-between">
                    рЃљрЃЊрЃњрЃўрЃџрЃЏрЃЊрЃћрЃЉрЃљрЃарЃћрЃЮрЃЉрЃљ
                    <span class="sort-indicator">{{ getSortIcon('location') }}</span>
                  </span>
              </th>
              <th class="sortable" (click)="onSort('price')" [class.sorted]="sortBy() === 'price'">
                  <span class="d-flex align-items-center justify-content-between">
                    рЃцрЃљрЃАрЃў (РѓЙ)
                    <span class="sort-indicator">{{ getSortIcon('price') }}</span>
                  </span>
              </th>
              <th class="text-center" style="width: 150px;">рЃЮрЃърЃћрЃарЃљрЃфрЃўрЃћрЃЉрЃў</th>
            </tr>
            </thead>
            <tbody>

              @for (item of items(); track item.id) {
                <tr class="table-row">
                  <td class="align-middle">
                    <strong>{{ item.name }}</strong>
                  </td>
                  <td class="align-middle">
                    <span class="badge bg-primary-subtle text-primary">
                      {{ item.location.name }}
                    </span>
                  </td>
                  <td class="align-middle">
                    <span class="price-value">{{ item.price | number:'1.2-2' }} РѓЙ</span>
                  </td>
                  <td class="align-middle text-center">
                    <button
                      class="btn btn-danger btn-sm"
                      (click)="deleteItem(item.id)"
                      title="рЃгрЃљрЃерЃџрЃљ">
                      ­ЪЌЉ№ИЈ рЃгрЃљрЃерЃџрЃљ
                    </button>
                  </td>
                </tr>
              }
            </tbody>
          </table>


          @if (items().length === 0) {
            <div class="empty-state">
              <div class="empty-icon">­ЪЊд</div>
              <h4>рЃюрЃўрЃЋрЃЌрЃћрЃЉрЃў рЃљрЃа рЃЏрЃЮрЃўрЃФрЃћрЃЉрЃюрЃљ</h4>
              <p class="text-muted">рЃАрЃфрЃљрЃЊрЃћрЃЌ рЃцрЃўрЃџрЃбрЃарЃўрЃА рЃерЃћрЃфрЃЋрЃџрЃљ рЃљрЃю рЃЊрЃљрЃљрЃЏрЃљрЃбрЃћрЃЌ рЃљрЃ«рЃљрЃџрЃў рЃюрЃўрЃЋрЃЌрЃў</p>
            </div>
          }
        </div>
      }
    </div>


    @if (!loading() && totalPages() > 1) {
      <div class="card-footer bg-light">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">

          <div class="pagination-info">
            <span class="text-muted">
              рЃАрЃБрЃџ: <strong class="text-dark">{{ totalItems() }}</strong> рЃюрЃўрЃЋрЃЌрЃў
            </span>
          </div>


          <nav aria-label="Pagination">
            <ul class="pagination mb-0">

              <li class="page-item" [class.disabled]="currentPage() === 1">
                <button
                  class="page-link"
                  (click)="goToPage(currentPage() - 1)"
                  [disabled]="currentPage() === 1">
                  Рєљ рЃгрЃўрЃюрЃљ
                </button>
              </li>


              @if (pageNumbers[0] > 1) {
                <li class="page-item">
                  <button class="page-link" (click)="goToPage(1)">1</button>
                </li>
                @if (pageNumbers[0] > 2) {
                  <li class="page-item disabled">
                    <span class="page-link">...</span>
                  </li>
                }
              }


              @for (page of pageNumbers; track page) {
                <li class="page-item" [class.active]="page === currentPage()">
                  <button class="page-link" (click)="goToPage(page)">
                    {{ page }}
                  </button>
                </li>
              }


              @if (pageNumbers[pageNumbers.length - 1] < totalPages()) {
                @if (pageNumbers[pageNumbers.length - 1] < totalPages() - 1) {
                  <li class="page-item disabled">
                    <span class="page-link">...</span>
                  </li>
                }
                <li class="page-item">
                  <button class="page-link" (click)="goToPage(totalPages())">
                    {{ totalPages() }}
                  </button>
                </li>
              }


              <li class="page-item" [class.disabled]="currentPage() === totalPages()">
                <button
                  class="page-link"
                  (click)="goToPage(currentPage() + 1)"
                  [disabled]="currentPage() === totalPages()">
                  рЃерЃћрЃЏрЃЊрЃћрЃњрЃў Рєњ
                </button>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    }
  </div>
</div>
